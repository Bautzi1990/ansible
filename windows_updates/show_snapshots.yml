---
# Show all snaphots
# Abarbeitung Seriell
# 5 Server pro Schritt

- name: Windows-Updates mit VMware-Snapshot
  hosts:
    - all
  serial:
    - 1
  strategy: free
  gather_facts: no

  tasks:
    - name: Gather snapshot information about the virtual machine in the given vCenter
      community.vmware.vmware_guest_snapshot_info:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: false
        datacenter: "{{ datacenter_name }}"
        folder: /
        name: "{{ inventory_hostname_short }}"
      delegate_to: localhost
      register: snapshot_info
      
    - name: print variable
      debug:
        msg: '{{ snapshot_info.guest_snapshots }}'
